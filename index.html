<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI‚ÄìAR Sustainable Khon Mask Lab | ‡∏™‡∏≤‡∏ô‡∏®‡∏¥‡∏•‡∏õ‡πå ‡∏ñ‡∏¥‡πà‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</title>
    
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-face-aframe.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Noto+Serif+Thai:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold:#C9922A; --gl:#F5C842; --red:#8B1A1A;
            --blk:#0A0806; --cream:#F7F0E0; --glass:rgba(255, 255, 255, 0.05);
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            background:var(--blk);color:var(--cream);
            font-family:'Noto Serif Thai',serif;overflow-x:hidden;line-height:1.6;
            display:flex;flex-direction:column;align-items:center;
        }

        /* ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ */
        .tnav{
            position:fixed;top:0;width:100%;padding:1rem 5%;z-index:1000;
            display:flex;justify-content:space-between;align-items:center;
            background:rgba(10,8,6,0.95);border-bottom:1px solid rgba(201,146,42,0.2);
            backdrop-filter:blur(10px);
        }
        .n-logo{font-family:'Cinzel Decorative',cursive;color:var(--gold);font-size:1.2rem;}
        .n-links{display:flex;gap:20px;}
        .n-link{color:var(--gold);font-size:0.85rem;cursor:pointer;transition:0.3s;text-decoration:none;}

        /* ‚îÄ‚îÄ Pages ‚îÄ‚îÄ */
        .page{
            display:none;width:100%;min-height:100vh;
            padding:120px 10% 60px;opacity:0;transition:opacity 0.5s ease;
            flex-direction:column;align-items:center;text-align:center;
        }
        .page.active{display:flex;opacity:1;}
        h1,h2{font-family:'Cinzel Decorative',cursive;color:var(--gold);margin-bottom:1.5rem;width:100%;}
        .sub-t{font-size:0.9rem;color:var(--gl);margin-bottom:2rem;letter-spacing:1px;width:100%;}
        .btn-gold{padding:12px 40px;background:linear-gradient(135deg,var(--gold),#8A641A);border:none;color:#000;font-weight:900;border-radius:50px;cursor:pointer;transition:0.3s;}
        .hidden{display:none !important;}

        /* ‚îÄ‚îÄ P2 Designer ‚îÄ‚îÄ */
        .p2-main{display:flex;flex-direction:column;width:100%;height:calc(100vh - 80px);}
        @media(min-width:1024px){.p2-main{flex-direction:row;}}
        .canvas-area{
            background:radial-gradient(circle,#222 0%,#000 100%);
            border:1px solid #333;border-radius:2.5rem;
            aspect-ratio:1/1;width:min(65vh,100%);
            display:flex;align-items:center;justify-content:center;position:relative;
        }
        .sidebar-right{width:100%;background:rgba(15,15,15,0.95);overflow-y:auto;padding:32px;border-left:1px solid rgba(197,160,89,0.2);}
        .sb-btn{width:100%;padding:10px;background:#27272a;border-radius:12px;color:#fff;margin-bottom:8px;cursor:pointer;border:1px solid transparent;}
        .sb-btn.active-btn{background:#c5a059 !important;color:#000 !important;font-weight:bold;}

        /* ‚îÄ‚îÄ AR FIX: ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏°‡πà‡∏î‡∏≥ ‚îÄ‚îÄ */
        #ar-container video {
            position: absolute !important;
            top: 0; left: 0;
            width: 100% !important; height: 100% !important;
            object-fit: cover !important;
            z-index: -1;
        }
        .a-canvas { background-color: transparent !important; }
        #flash-effect{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none;z-index:100;}

        /* ‚îÄ‚îÄ Bubble Wall ‚îÄ‚îÄ */
        #bubble-container{position:relative;width:100%;height:65vh;background:rgba(9,9,11,0.5);border-radius:3rem;overflow:hidden;}
        .bubble-photo{
            position:absolute;border-radius:50%;border:4px solid #c5a059;
            object-fit:cover;animation:floatBubble var(--dur,5s) ease-in-out infinite;
        }
        @keyframes floatBubble{
            0%, 100%{ transform: translate(0,0); }
            50%{ transform: translate(10px,-20px); }
        }
    </style>
</head>
<body>

<nav class="tnav">
    <div class="n-logo">KHON LAB</div>
    <div class="n-links">
        <span class="n-link" onclick="showPage('p0')">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
        <span class="n-link" onclick="showPage('p1')">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÇ‡∏Ç‡∏ô</span>
        <span class="n-link" onclick="showPage('p2')">AI ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö</span>
        <span class="n-link" onclick="showPage('p4')">AR Experience</span>
    </div>
</nav>

<section id="p0" class="page active">
    <h1>THE ROYAL CONNECTION</h1>
    <div class="img-container"><img src="queen.webp" alt="Queen" style="width:100%"></div>
    <button class="btn-gold mt-8" onclick="showPage('p1')">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</button>
</section>

<section id="p1" class="page">
    <h1>KNOWLEDGE HUB</h1>
    <div style="max-width:800px; background:rgba(255,255,255,0.03); padding:30px; border-radius:20px;">
        <img src="https://raw.githubusercontent.com/TiTle-GS/Khon-Mask-Lab/main/khon-3.jpg" style="width:100%; border-radius:15px;">
        <button class="btn-gold mt-8" onclick="showPage('p2')">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö ‚Üí</button>
    </div>
</section>

<section id="p2" class="page">
    <div class="p2-main">
        <div class="flex-1 flex flex-col items-center justify-center p-4">
            <div class="canvas-area">
                <svg id="main-svg" viewBox="0 0 400 400">
                    <path id="part-face" d="M120 130 C120 130 100 180 100 240 C100 320 160 360 200 360 C240 360 300 320 300 240 C300 180 280 130 280 130 Z" fill="#16a34a"/>
                    <path id="part-crown" d="M140 80 L260 80 L200 10 Z" fill="#FFD700"/>
                    <circle cx="165" cy="212" r="6" fill="black"/><circle cx="235" cy="212" r="6" fill="black"/>
                </svg>
            </div>
            <div class="mt-4 flex gap-4">
                <button class="btn-gold" onclick="randomizeDesigner()">üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏™‡∏µ</button>
                <button class="btn-gold" onclick="applyToAR()">üé≠ ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô AR ‚Üí</button>
            </div>
        </div>
        <aside class="sidebar-right">
            <h2 class="text-[#c5a059] mb-4">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏µ</h2>
            <input type="color" id="pick-face" oninput="syncDesigner()" style="width:100%; height:50px; cursor:pointer;">
        </aside>
    </div>
</section>

<section id="p4" class="page">
    <h1>AR EXPERIENCE</h1>
    <div class="relative w-full max-w-lg aspect-[3/4] rounded-[2rem] overflow-hidden border-2 border-[#c5a059] mx-auto bg-black">
        <div id="ar-container" class="w-full h-full">
            <a-scene mindar-face="autoStart: false; uiLoading: no; uiScanning: no" embedded color-space="sRGB" renderer="transparent: true; preserveDrawingBuffer: true" vr-mode-ui="enabled: false">
                <a-camera active="false" position="0 0 0"></a-camera>
                
                <a-entity mindar-face-target="anchorIndex: 168">
                    <a-entity id="mask-pivot">
                        <a-sphere id="ar-face-model" radius="0.4" scale="1 1.2 0.8" position="0 0 0.1" material="color: #16a34a"></a-sphere>
                        <a-cone id="ar-crown-model" radius-bottom="0.2" height="0.6" position="0 0.6 0" material="color: #FFD700"></a-cone>
                    </a-entity>
                </a-entity>
            </a-scene>
        </div>

        <div class="absolute bottom-6 left-0 right-0 flex flex-col items-center gap-4 px-6">
            <div class="w-full flex gap-2">
                <input type="range" id="ar-size" min="0.5" max="2" step="0.1" value="1" oninput="adjustAR()" class="flex-1">
                <input type="range" id="ar-pos" min="-1" max="1" step="0.1" value="0" oninput="adjustAR()" class="flex-1">
            </div>
            <div class="flex gap-4">
                <button id="btn-start" class="btn-gold" onclick="startAR()">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
                <button id="btn-snap" class="btn-gold hidden" style="background:#fff" onclick="takeARPhoto()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>
                <button id="btn-close" class="btn-gold hidden" style="background:#8B1A1A; color:#fff" onclick="location.reload()">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
        <div id="flash-effect"></div>
    </div>
</section>

<section id="p5" class="page">
    <h1>BUBBLE WALL</h1>
    <div id="bubble-container"></div>
    <button class="btn-gold mt-8" onclick="showPage('p4')">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>
</section>

<script>
    let capturedList = [];

    // NAVIGATION
    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    // P2 DESIGNER
    function syncDesigner() {
        const c = document.getElementById('pick-face').value;
        document.getElementById('part-face').setAttribute('fill', c);
    }
    function randomizeDesigner() {
        const c = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6,'0');
        document.getElementById('pick-face').value = c;
        syncDesigner();
    }
    function applyToAR() {
        const c = document.getElementById('pick-face').value;
        document.getElementById('ar-face-model').setAttribute('material', 'color', c);
        showPage('p4');
    }

    // AR LOGIC
    function startAR() {
        const scene = document.querySelector('a-scene');
        scene.systems['mindar-face-system'].start(); // ‡∏™‡∏±‡πà‡∏á MindAR ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        document.getElementById('btn-start').classList.add('hidden');
        document.getElementById('btn-snap').classList.remove('hidden');
        document.getElementById('btn-close').classList.remove('hidden');
    }

    function adjustAR() {
        const s = document.getElementById('ar-size').value;
        const p = document.getElementById('ar-pos').value;
        document.getElementById('mask-pivot').setAttribute('scale', `${s} ${s} ${s}`);
        document.getElementById('mask-pivot').setAttribute('position', `0 ${p} 0`);
    }

    function takeARPhoto() {
        const flash = document.getElementById('flash-effect');
        flash.style.opacity = '1';
        setTimeout(() => flash.style.opacity = '0', 100);

        const video = document.querySelector('video');
        const canvas = document.querySelector('.a-canvas');
        const final = document.createElement('canvas');
        final.width = video.videoWidth;
        final.height = video.videoHeight;
        const ctx = final.getContext('2d');

        ctx.drawImage(video, 0, 0); // ‡∏ß‡∏≤‡∏î‡∏Ñ‡∏ô
        ctx.drawImage(canvas, 0, 0, final.width, final.height); // ‡∏ß‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å‡∏ó‡∏±‡∏ö

        const data = final.toDataURL('image/png');
        addBubble(data);
        showPage('p5');
    }

    function addBubble(src) {
        const container = document.getElementById('bubble-container');
        const img = document.createElement('img');
        img.src = src;
        img.className = 'bubble-photo';
        const sz = Math.random()*50 + 100;
        img.style.width = sz+'px'; img.style.height = sz+'px';
        img.style.left = Math.random()*80+'%';
        img.style.top = Math.random()*80+'%';
        img.style.setProperty('--dur', (Math.random()*3+4)+'s');
        container.appendChild(img);
    }
</script>
</body>
</html>
